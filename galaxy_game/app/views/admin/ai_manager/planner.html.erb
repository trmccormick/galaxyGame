<!DOCTYPE html>
<html>
<head>
  <title>AI Manager - Mission Planner</title>
  <link rel="stylesheet" href="/assets/admin/monitor.css">
  <style>
    .planner-layout {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 20px;
      margin: 20px;
    }
    
    .panel {
      background: #111;
      border: 2px solid #0f0;
      padding: 15px;
      min-height: 600px;
    }
    
    .panel h2 {
      color: #0ff;
      font-family: 'Courier New', monospace;
      margin: 0 0 15px 0;
      padding-bottom: 10px;
      border-bottom: 1px solid #0f0;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      color: #0f0;
      font-family: 'Courier New', monospace;
      margin-bottom: 5px;
    }
    
    .form-group select,
    .form-group input {
      width: 100%;
      background: #000;
      border: 1px solid #0f0;
      color: #0f0;
      font-family: 'Courier New', monospace;
      padding: 8px;
      font-size: 14px;
    }
    
    .simulate-button {
      background: #0f0;
      color: #000;
      border: none;
      padding: 12px 24px;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
      margin-top: 10px;
    }
    
    .simulate-button:hover {
      background: #0ff;
    }
    
    .results-section {
      margin-bottom: 20px;
      padding: 10px;
      background: #000;
      border: 1px solid #0f0;
    }
    
    .results-section h3 {
      color: #0ff;
      font-family: 'Courier New', monospace;
      margin: 0 0 10px 0;
      font-size: 16px;
    }
    
    .stat-line {
      color: #0f0;
      font-family: 'Courier New', monospace;
      margin: 5px 0;
      font-size: 13px;
    }
    
    .resource-list {
      max-height: 200px;
      overflow-y: auto;
    }
    
    .resource-item {
      color: #0f0;
      font-family: 'Courier New', monospace;
      padding: 3px 0;
      border-bottom: 1px dotted #0f0;
      font-size: 12px;
    }
    
    .year-row {
      color: #0f0;
      font-family: 'Courier New', monospace;
      padding: 5px;
      border-bottom: 1px solid #0f0;
      display: grid;
      grid-template-columns: 50px 1fr;
    }
    
    .bottleneck {
      background: #330;
      border-left: 3px solid #f00;
      padding: 8px;
      margin: 5px 0;
    }
    
    .opportunity {
      background: #033;
      border-left: 3px solid #0ff;
      padding: 8px;
      margin: 5px 0;
    }
    
    .risk {
      background: #330;
      border-left: 3px solid #ff0;
      padding: 8px;
      margin: 5px 0;
    }
    
    .export-button {
      background: #000;
      color: #0ff;
      border: 1px solid #0ff;
      padding: 8px 16px;
      font-family: 'Courier New', monospace;
      cursor: pointer;
      margin-top: 10px;
    }
    
    .export-button:hover {
      background: #0ff;
      color: #000;
    }
    
    .breadcrumb {
      color: #0f0;
      font-family: 'Courier New', monospace;
      padding: 10px 20px;
      background: #000;
      border-bottom: 2px solid #0f0;
    }
    
    .breadcrumb a {
      color: #0ff;
      text-decoration: none;
    }
    
    .breadcrumb a:hover {
      color: #fff;
    }
  </style>
</head>
<body style="background: #000; margin: 0; padding: 0;">
  <!-- Breadcrumb Navigation -->
  <div class="breadcrumb">
    <%= link_to '◄ Back to Missions', admin_ai_manager_missions_path %> | MISSION PLANNER
  </div>

  <div class="planner-layout">
    <!-- LEFT PANEL: Configuration -->
    <div class="panel">
      <h2>█ SIMULATION CONFIG</h2>
      
      <%= form_with url: admin_ai_manager_planner_path, method: :get, local: true do |f| %>
        <div class="form-group">
          <label>MISSION PATTERN:</label>
          <%= select_tag :pattern, 
            options_for_select(@available_patterns.map { |p| [p.upcase, p] }, params[:pattern]),
            prompt: "Select Pattern..." 
          %>
        </div>
        
        <div class="form-group">
          <label>TECH LEVEL:</label>
          <%= select_tag :tech_level,
            options_for_select([
              ['STANDARD (Current Tech)', 'standard'],
              ['ADVANCED (+10 Years)', 'advanced'],
              ['EXPERIMENTAL (+20 Years)', 'experimental']
            ], params[:tech_level] || 'standard')
          %>
        </div>
        
        <div class="form-group">
          <label>TIMELINE (Years):</label>
          <%= number_field_tag :timeline_years, params[:timeline_years] || 10, min: 5, max: 50 %>
        </div>
        
        <div class="form-group">
          <label>BUDGET (GCC):</label>
          <%= number_field_tag :budget_gcc, params[:budget_gcc] || 1_000_000, min: 100_000, step: 100_000 %>
        </div>
        
        <div class="form-group">
          <label>PRIORITY:</label>
          <%= select_tag :priority,
            options_for_select([
              ['BALANCED', 'balanced'],
              ['SPEED (Fast Timeline)', 'speed'],
              ['EFFICIENCY (Low Cost)', 'efficiency'],
              ['RELIABILITY (High Success)', 'reliability']
            ], params[:priority] || 'balanced')
          %>
        </div>
        
        <%= submit_tag 'RUN SIMULATION', class: 'simulate-button' %>
      <% end %>
      
      <% if @simulation_result.present? %>
        <div style="margin-top: 20px;">
          <%= button_to 'EXPORT PLAN (JSON)', 
            admin_ai_manager_export_plan_path(
              pattern: params[:pattern],
              parameters: {
                tech_level: params[:tech_level],
                timeline_years: params[:timeline_years],
                budget_gcc: params[:budget_gcc],
                priority: params[:priority]
              }.to_json
            ),
            method: :post,
            class: 'export-button'
          %>
        </div>
      <% end %>
    </div>
    
    <!-- MIDDLE PANEL: Results -->
    <div class="panel">
      <h2>█ SIMULATION RESULTS</h2>
      
      <% if @simulation_result.present? %>
        <!-- Timeline -->
        <div class="results-section">
          <h3>▸ TIMELINE</h3>
          <div class="stat-line">Duration: <%= @simulation_result[:timeline][:total_years] %> years</div>
          <div class="stat-line">Phases: <%= @simulation_result[:timeline][:phases].size %></div>
          <% @simulation_result[:timeline][:phases].each do |phase| %>
            <div class="stat-line">  • <%= phase[:name] %>: <%= phase[:duration] %> years</div>
          <% end %>
        </div>
        
        <!-- Costs -->
        <div class="results-section">
          <h3>▸ TOTAL COST</h3>
          <div class="stat-line">Base Cost: <%= number_to_human(@simulation_result[:costs][:total_gcc], precision: 2) %> GCC</div>
          <div class="stat-line">Contingency: <%= number_to_human(@simulation_result[:costs][:contingency], precision: 2) %> GCC</div>
          <div class="stat-line" style="color: #0ff; font-weight: bold;">Grand Total: <%= number_to_human(@simulation_result[:costs][:grand_total], precision: 2) %> GCC</div>
        </div>
        
        <!-- Player Revenue -->
        <div class="results-section">
          <h3>▸ PLAYER OPPORTUNITIES</h3>
          <div class="stat-line" style="color: #0ff;">Total Revenue: <%= number_to_human(@simulation_result[:player_revenue][:total_opportunity_gcc], precision: 2) %> GCC</div>
          <div class="stat-line">Contracts: ~<%= @simulation_result[:player_revenue][:contract_count] %></div>
          <div class="stat-line">Avg Value: <%= number_to_human(@simulation_result[:player_revenue][:average_contract_value], precision: 2) %> GCC</div>
        </div>
        
        <!-- Resources -->
        <div class="results-section">
          <h3>▸ RESOURCE REQUIREMENTS</h3>
          <div class="stat-line">Peak Demand: Year <%= @simulation_result[:resources][:peak_demand][:year] %></div>
          <div class="resource-list">
            <% @simulation_result[:resources][:total].sort_by { |_, qty| -qty }.first(10).each do |resource, quantity| %>
              <div class="resource-item">
                <%= resource.ljust(20) %> <%= number_to_human(quantity, precision: 0) %> units
              </div>
            <% end %>
          </div>
        </div>
        
        <!-- Planetary Changes -->
        <% if @simulation_result[:planetary_changes].present? %>
          <div class="results-section">
            <h3>▸ PLANETARY CHANGES</h3>
            <% @simulation_result[:planetary_changes].each do |category, changes| %>
              <div class="stat-line" style="color: #0ff;"><%= category.to_s.upcase %>:</div>
              <% if changes.is_a?(Hash) %>
                <% changes.each do |key, value| %>
                  <div class="stat-line">  <%= key.to_s.humanize %>: <%= value %></div>
                <% end %>
              <% else %>
                <div class="stat-line">  <%= changes %></div>
              <% end %>
            <% end %>
          </div>
        <% end %>
        
      <% else %>
        <div style="color: #0f0; font-family: 'Courier New', monospace; text-align: center; padding: 50px;">
          ▶ SELECT PATTERN AND RUN SIMULATION
        </div>
      <% end %>
    </div>
    
    <!-- RIGHT PANEL: Economic Forecast -->
    <div class="panel">
      <h2>█ ECONOMIC FORECAST</h2>
      
      <% if @forecast.present? %>
        <!-- GCC Distribution -->
        <div class="results-section">
          <h3>▸ GCC FLOW ANALYSIS</h3>
          <div class="stat-line">Total Project: <%= number_to_human(@forecast[:gcc_distribution][:total_project_cost], precision: 2) %> GCC</div>
          <div class="stat-line">DC Expenditure: <%= @forecast[:gcc_distribution][:dc_percentage] %>%</div>
          <div class="stat-line" style="color: #0ff;">Player Earnings: <%= @forecast[:gcc_distribution][:player_percentage] %>%</div>
          <div class="stat-line">Economic Velocity: <%= number_to_human(@forecast[:gcc_distribution][:economic_velocity], precision: 2) %> GCC/year</div>
        </div>
        
        <!-- Demand Forecast -->
        <div class="results-section">
          <h3>▸ DEMAND FORECAST</h3>
          <div class="stat-line">Trend: <%= @forecast[:demand_forecast][:demand_curve][:trend].upcase %></div>
          <div class="stat-line">Peak: Year <%= @forecast[:demand_forecast][:peak_demand][:year] %> (<%= number_to_human(@forecast[:demand_forecast][:peak_demand][:total_units]) %> units)</div>
          <div class="stat-line">Critical Resources: <%= @forecast[:demand_forecast][:critical_resources].size %></div>
        </div>
        
        <!-- Bottlenecks -->
        <% if @forecast[:bottlenecks].any? %>
          <div class="results-section">
            <h3>▸ BOTTLENECKS (<%= @forecast[:bottlenecks].size %>)</h3>
            <% @forecast[:bottlenecks].first(3).each do |bottleneck| %>
              <div class="bottleneck">
                <div class="stat-line" style="color: #f00;">
                  <%= bottleneck[:resource] || "Year #{bottleneck[:year]}" %> [<%= bottleneck[:severity].upcase %>]
                </div>
                <div class="stat-line" style="color: #ff0; font-size: 11px;">
                  <%= bottleneck[:recommendation] %>
                </div>
              </div>
            <% end %>
          </div>
        <% end %>
        
        <!-- Opportunities -->
        <% if @forecast[:opportunities].any? %>
          <div class="results-section">
            <h3>▸ OPPORTUNITIES (<%= @forecast[:opportunities].size %>)</h3>
            <% @forecast[:opportunities].first(3).each do |opp| %>
              <div class="opportunity">
                <div class="stat-line" style="color: #0ff;">
                  <%= opp[:type].upcase.gsub('_', ' ') %>
                </div>
                <div class="stat-line" style="font-size: 11px;">
                  <%= opp[:description] %>
                </div>
              </div>
            <% end %>
          </div>
        <% end %>
        
        <!-- Risks -->
        <% if @forecast[:risk_assessment].any? %>
          <div class="results-section">
            <h3>▸ RISK ASSESSMENT</h3>
            <% @forecast[:risk_assessment].each do |risk| %>
              <div class="risk">
                <div class="stat-line" style="color: #ff0;">
                  <%= risk[:category].upcase %> [<%= risk[:severity].upcase %>]
                </div>
                <div class="stat-line" style="font-size: 11px;">
                  <%= risk[:description] %>
                </div>
                <div class="stat-line" style="font-size: 11px; color: #0ff;">
                  ▸ <%= risk[:mitigation] %>
                </div>
              </div>
            <% end %>
          </div>
        <% end %>
        
      <% else %>
        <div style="color: #0f0; font-family: 'Courier New', monospace; text-align: center; padding: 50px;">
          ▶ AWAITING SIMULATION DATA
        </div>
      <% end %>
    </div>
  </div>
</body>
</html>
