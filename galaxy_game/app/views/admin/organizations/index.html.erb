<!DOCTYPE html>
<html>
<head>
  <title>Organization Monitor | Admin</title>
  <%= stylesheet_link_tag 'admin/monitor', media: 'all' %>
  <style>
    body {
      overflow-y: auto !important;
      overflow-x: hidden;
    }
    
    .dc-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
      gap: 20px;
      padding: 20px;
    }
    
    .dc-card {
      background: #000;
      border: 2px solid #0f0;
      padding: 15px;
      font-family: 'Courier New', monospace;
    }
    
    .dc-header {
      color: #0ff;
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
      border-bottom: 1px solid #0f0;
      padding-bottom: 5px;
    }
    
    .dc-stat {
      color: #0f0;
      margin: 5px 0;
      display: flex;
      justify-content: space-between;
    }
    
    .dc-stat-label {
      color: #0f0;
    }
    
    .dc-stat-value {
      color: #fff;
      font-weight: bold;
    }
    
    .settlement-list {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #0f0;
    }
    
    .settlement-item {
      color: #0f0;
      margin: 3px 0;
      font-size: 12px;
    }
    
    .settlement-location {
      color: #888;
      margin-left: 10px;
    }
    
    .contract-badge {
      display: inline-block;
      background: #0f0;
      color: #000;
      padding: 2px 6px;
      font-size: 10px;
      font-weight: bold;
      border-radius: 3px;
      margin-left: 5px;
    }
    
    .view-details-btn {
      background: #0f0;
      color: #000;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      margin-top: 10px;
      width: 100%;
    }
    
    .view-details-btn:hover {
      background: #0ff;
    }
    
    .stats-panel {
      background: #000;
      border: 2px solid #0f0;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }
    
    .stat-box {
      text-align: center;
      border-right: 1px solid #0f0;
    }
    
    .stat-box:last-child {
      border-right: none;
    }
    
    .stat-number {
      color: #0ff;
      font-size: 36px;
      font-weight: bold;
    }
    
    .stat-label {
      color: #0f0;
      font-size: 14px;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="monitor-header">
    <div class="header-left">
      <h1>▼ ORGANIZATION MONITOR</h1>
      <div class="breadcrumb">
        <%= link_to "ADMIN", admin_dashboard_path %> &gt; 
        <span>ORGANIZATIONS</span>
      </div>
    </div>
    <div class="header-right">
      <div class="status-indicator">
        <span class="blink">●</span> <%= Time.current.strftime("%Y-%m-%d %H:%M:%S UTC") %>
      </div>
    </div>
  </div>

  <!-- Statistics Panel -->
  <div class="stats-panel">
    <div class="stats-grid">
      <div class="stat-box">
        <div class="stat-number"><%= @total_npc_count %></div>
        <div class="stat-label">NPC ORGANIZATIONS</div>
      </div>
      <div class="stat-box">
        <div class="stat-number"><%= @total_player_count %></div>
        <div class="stat-label">PLAYER ORGANIZATIONS</div>
      </div>
      <div class="stat-box">
        <div class="stat-number"><%= @total_consortium_count %></div>
        <div class="stat-label">CONSORTIUMS</div>
      </div>
    </div>
  </div>

  <!-- NPC Organizations Section -->
  <% if @npc_organizations.any? %>
    <div style="padding: 20px; border-bottom: 2px solid #0f0;">
      <h2 style="color: #0ff; font-size: 20px; margin: 0;">▼ NPC ORGANIZATIONS</h2>
      <div style="color: #888; font-size: 12px;">AI-controlled corporations and development entities</div>
    </div>
    
    <div class="dc-grid">
      <% @npc_organizations.each do |org| %>
        <%= render partial: 'org_card', locals: { org: org, settlements: @settlements_by_org[org.id] || [], contracts: (@active_contracts[org.id] || []).count } %>
      <% end %>
    </div>
  <% end %>

  <!-- Player Organizations Section -->
  <% if @player_organizations.any? %>
    <div style="padding: 20px; border-bottom: 2px solid #0f0; margin-top: 20px;">
      <h2 style="color: #0ff; font-size: 20px; margin: 0;">▼ PLAYER ORGANIZATIONS</h2>
      <div style="color: #888; font-size: 12px;">Player-owned corporations and enterprises</div>
    </div>
    
    <div class="dc-grid">
      <% @player_organizations.each do |org| %>
        <%= render partial: 'org_card', locals: { org: org, settlements: @settlements_by_org[org.id] || [], contracts: (@active_contracts[org.id] || []).count } %>
      <% end %>
    </div>
  <% end %>

  <!-- Consortiums Section -->
  <% if @consortiums.any? %>
    <div style="padding: 20px; border-bottom: 2px solid #0f0; margin-top: 20px;">
      <h2 style="color: #0ff; font-size: 20px; margin: 0;">▼ CONSORTIUMS</h2>
      <div style="color: #888; font-size: 12px;">Multi-corporate alliances and collaborative entities</div>
    </div>
    
    <div class="dc-grid">
      <% @consortiums.each do |consortium| %>
        <%= render partial: 'org_card', locals: { org: consortium, settlements: @settlements_by_org[consortium.id] || [], contracts: (@active_contracts[consortium.id] || []).count } %>
      <% end %>
    </div>
  <% end %>

  <!-- Empty State -->
  <% if @npc_organizations.empty? && @player_organizations.empty? && @consortiums.empty? %>
    <div class="dc-grid">
      <div class="dc-card">
        <div class="dc-header" style="color: #f80;">NO ORGANIZATIONS FOUND</div>
        <div style="color: #888; margin-top: 10px;">
          No organizations have been initialized in the database.
          Run <span style="color: #0f0;">rails db:seed</span> to create initial corporations.
        </div>
      </div>
    </div>
  <% end %>
</body>
</html>
