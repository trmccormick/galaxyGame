  [1m[36mActiveRecord::InternalMetadata Pluck (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (18.4ms)[0m  [1m[35mALTER TABLE "access_points" DISABLE TRIGGER ALL;ALTER TABLE "accounts" DISABLE TRIGGER ALL;ALTER TABLE "adapted_features" DISABLE TRIGGER ALL;ALTER TABLE "atmospheres" DISABLE TRIGGER ALL;ALTER TABLE "base_crafts" DISABLE TRIGGER ALL;ALTER TABLE "base_locations" DISABLE TRIGGER ALL;ALTER TABLE "base_modules" DISABLE TRIGGER ALL;ALTER TABLE "base_rigs" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL;ALTER TABLE "base_settlements" DISABLE TRIGGER ALL;ALTER TABLE "base_units" DISABLE TRIGGER ALL;ALTER TABLE "biology_life_form_parents" DISABLE TRIGGER ALL;ALTER TABLE "blueprints" DISABLE TRIGGER ALL;ALTER TABLE "bonds" DISABLE TRIGGER ALL;ALTER TABLE "biomes" DISABLE TRIGGER ALL;ALTER TABLE "biology_life_forms" DISABLE TRIGGER ALL;ALTER TABLE "biospheres" DISABLE TRIGGER ALL;ALTER TABLE "celestial_bodies_materials" DISABLE TRIGGER ALL;ALTER TABLE "celestial_locations" DISABLE TRIGGER ALL;ALTER TABLE "claims_claim_payouts" DISABLE TRIGGER ALL;ALTER TABLE "claims_claim_denials" DISABLE TRIGGER ALL;ALTER TABLE "celestial_bodies_alien_life_forms" DISABLE TRIGGER ALL;ALTER TABLE "consortium_memberships" DISABLE TRIGGER ALL;ALTER TABLE "construction_jobs" DISABLE TRIGGER ALL;ALTER TABLE "cyclers" DISABLE TRIGGER ALL;ALTER TABLE "component_production_jobs" DISABLE TRIGGER ALL;ALTER TABLE "currencies" DISABLE TRIGGER ALL;ALTER TABLE "equipment_requests" DISABLE TRIGGER ALL;ALTER TABLE "game_states" DISABLE TRIGGER ALL;ALTER TABLE "geological_materials" DISABLE TRIGGER ALL;ALTER TABLE "galaxies" DISABLE TRIGGER ALL;ALTER TABLE "environments" DISABLE TRIGGER ALL;ALTER TABLE "exchange_rates" DISABLE TRIGGER ALL;ALTER TABLE "gases" DISABLE TRIGGER ALL;ALTER TABLE "hydrospheres" DISABLE TRIGGER ALL;ALTER TABLE "inventories" DISABLE TRIGGER ALL;ALTER TABLE "insurance_policies" DISABLE TRIGGER ALL;ALTER TABLE "ledger_entries" DISABLE TRIGGER ALL;ALTER TABLE "logistics_contracts" DISABLE TRIGGER ALL;ALTER TABLE "logistics_providers" DISABLE TRIGGER ALL;ALTER TABLE "market_marketplaces" DISABLE TRIGGER ALL;ALTER TABLE "market_orders" DISABLE TRIGGER ALL;ALTER TABLE "market_trades" DISABLE TRIGGER ALL;ALTER TABLE "market_settings" DISABLE TRIGGER ALL;ALTER TABLE "market_supply_chains" DISABLE TRIGGER ALL;ALTER TABLE "material_piles" DISABLE TRIGGER ALL;ALTER TABLE "market_transaction_fees" DISABLE TRIGGER ALL;ALTER TABLE "material_processing_jobs" DISABLE TRIGGER ALL;ALTER TABLE "material_requests" DISABLE TRIGGER ALL;ALTER TABLE "mega_projects" DISABLE TRIGGER ALL;ALTER TABLE "migration_logs" DISABLE TRIGGER ALL;ALTER TABLE "mining_logs" DISABLE TRIGGER ALL;ALTER TABLE "materials" DISABLE TRIGGER ALL;ALTER TABLE "npc_colonies" DISABLE TRIGGER ALL;ALTER TABLE "planet_biomes" DISABLE TRIGGER ALL;ALTER TABLE "orbital_relationships" DISABLE TRIGGER ALL;ALTER TABLE "missions" DISABLE TRIGGER ALL;ALTER TABLE "orbital_construction_projects" DISABLE TRIGGER ALL;ALTER TABLE "route_proposal_votes" DISABLE TRIGGER ALL;ALTER TABLE "player_contracts" DISABLE TRIGGER ALL;ALTER TABLE "plant_environments" DISABLE TRIGGER ALL;ALTER TABLE "rigs" DISABLE TRIGGER ALL;ALTER TABLE "route_proposals" DISABLE TRIGGER ALL;ALTER TABLE "plants" DISABLE TRIGGER ALL;ALTER TABLE "segment_components" DISABLE TRIGGER ALL;ALTER TABLE "shell_printing_jobs" DISABLE TRIGGER ALL;ALTER TABLE "skylights" DISABLE TRIGGER ALL;ALTER TABLE "scheduled_arrivals" DISABLE TRIGGER ALL;ALTER TABLE "scheduled_departures" DISABLE TRIGGER ALL;ALTER TABLE "seal_printing_jobs" DISABLE TRIGGER ALL;ALTER TABLE "spatial_locations" DISABLE TRIGGER ALL;ALTER TABLE "star_distances" DISABLE TRIGGER ALL;ALTER TABLE "sponsorships" DISABLE TRIGGER ALL;ALTER TABLE "special_missions" DISABLE TRIGGER ALL;ALTER TABLE "stars" DISABLE TRIGGER ALL;ALTER TABLE "structures" DISABLE TRIGGER ALL;ALTER TABLE "transactions" DISABLE TRIGGER ALL;ALTER TABLE "worldhouse_segments" DISABLE TRIGGER ALL;ALTER TABLE "unit_assembly_jobs" DISABLE TRIGGER ALL;ALTER TABLE "structures_planetary_umbilical_hubs" DISABLE TRIGGER ALL;ALTER TABLE "colonies" DISABLE TRIGGER ALL;ALTER TABLE "celestial_bodies" DISABLE TRIGGER ALL;ALTER TABLE "players" DISABLE TRIGGER ALL;ALTER TABLE "wormholes" DISABLE TRIGGER ALL;ALTER TABLE "bond_repayments" DISABLE TRIGGER ALL;ALTER TABLE "organizations" DISABLE TRIGGER ALL;ALTER TABLE "solar_systems" DISABLE TRIGGER ALL;ALTER TABLE "dwarf_planets" DISABLE TRIGGER ALL;ALTER TABLE "geospheres" DISABLE TRIGGER ALL;ALTER TABLE "items" DISABLE TRIGGER ALL;ALTER TABLE "liquid_materials" DISABLE TRIGGER ALL;ALTER TABLE "market_conditions" DISABLE TRIGGER ALL;ALTER TABLE "market_price_histories" DISABLE TRIGGER ALL;ALTER TABLE "surface_storages" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (4.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (2.3ms)[0m  [1m[34m            SELECT schemaname || '.' || tablename
            FROM pg_tables
            WHERE
              tablename !~ '_prt_' AND
              tablename <> 'schema_migrations'
  AND tablename <> 'ar_internal_metadata'
 AND
              schemaname = ANY (current_schemas(false))
[0m
  [1m[35m (1.0ms)[0m  [1m[34mselect table_name from information_schema.views where table_schema = 'galaxy_game_test'[0m
  [1m[35m (7.1ms)[0m  [1m[35mTRUNCATE TABLE "access_points", "accounts", "adapted_features", "atmospheres", "base_crafts", "base_locations", "base_modules", "base_rigs", "base_settlements", "base_units", "biology_life_form_parents", "blueprints", "bonds", "biomes", "biology_life_forms", "biospheres", "celestial_bodies_materials", "celestial_locations", "claims_claim_payouts", "claims_claim_denials", "celestial_bodies_alien_life_forms", "consortium_memberships", "construction_jobs", "cyclers", "component_production_jobs", "currencies", "equipment_requests", "game_states", "geological_materials", "galaxies", "environments", "exchange_rates", "gases", "hydrospheres", "inventories", "insurance_policies", "ledger_entries", "logistics_contracts", "logistics_providers", "market_marketplaces", "market_orders", "market_trades", "market_settings", "market_supply_chains", "material_piles", "market_transaction_fees", "material_processing_jobs", "material_requests", "mega_projects", "migration_logs", "mining_logs", "npc_colonies", "planet_biomes", "orbital_relationships", "missions", "orbital_construction_projects", "route_proposal_votes", "player_contracts", "plant_environments", "rigs", "route_proposals", "plants", "segment_components", "shell_printing_jobs", "skylights", "scheduled_arrivals", "scheduled_departures", "seal_printing_jobs", "spatial_locations", "star_distances", "sponsorships", "special_missions", "stars", "structures", "transactions", "worldhouse_segments", "unit_assembly_jobs", "structures_planetary_umbilical_hubs", "colonies", "celestial_bodies", "players", "wormholes", "bond_repayments", "organizations", "solar_systems", "dwarf_planets", "geospheres", "items", "liquid_materials", "market_conditions", "market_price_histories", "surface_storages" RESTART IDENTITY RESTRICT;[0m

An error occurred in a `before(:suite)` hook.
[31mFailure/Error:[0m
[31m  DatabaseCleaner.clean_with(:truncation, except: %w[[0m
[31m    celestial_bodies_celestial_bodies[0m
[31m    locations[0m
[31m    materials[0m
[31m    ar_internal_metadata[0m
[31m    schema_migrations[0m
[31m  ])[0m
[31m[0m
[31mActiveRecord::StatementInvalid:[0m
[31m  PG::FeatureNotSupported: ERROR:  cannot truncate a table referenced in a foreign key constraint[0m
[31m  DETAIL:  Table "materials" references "celestial_bodies".[0m
[31m  HINT:  Truncate table "materials" at the same time, or use TRUNCATE ... CASCADE.[0m
[36m# /usr/local/bundle/gems/database_cleaner-active_record-2.2.0/lib/database_cleaner/active_record/truncation.rb:198:in 'DatabaseCleaner::ActiveRecord::ConnectionWrapper::PostgreSQLAdapter#truncate_tables'[0m
[36m# /usr/local/bundle/gems/database_cleaner-active_record-2.2.0/lib/database_cleaner/active_record/truncation.rb:25:in 'block in DatabaseCleaner::ActiveRecord::Truncation#clean'[0m
[36m# /usr/local/bundle/gems/database_cleaner-active_record-2.2.0/lib/database_cleaner/active_record/truncation.rb:21:in 'DatabaseCleaner::ActiveRecord::Truncation#clean'[0m
[36m# /usr/local/bundle/gems/database_cleaner-core-2.0.1/lib/database_cleaner/cleaner.rb:65:in 'DatabaseCleaner::Cleaner#clean_with'[0m
[36m# /usr/local/bundle/gems/database_cleaner-core-2.0.1/lib/database_cleaner/cleaners.rb:40:in 'block in DatabaseCleaner::Cleaners#clean_with'[0m
[36m# /usr/local/bundle/gems/database_cleaner-core-2.0.1/lib/database_cleaner/cleaners.rb:40:in 'Array#each'[0m
[36m# /usr/local/bundle/gems/database_cleaner-core-2.0.1/lib/database_cleaner/cleaners.rb:40:in 'DatabaseCleaner::Cleaners#clean_with'[0m
[36m# ./spec/support/database_cleaner.rb:9:in 'block (2 levels) in <main>'[0m
[36m# ------------------[0m
[36m# --- Caused by: ---[0m
[36m# PG::FeatureNotSupported:[0m
[36m#   ERROR:  cannot truncate a table referenced in a foreign key constraint[0m
[36m#   DETAIL:  Table "materials" references "celestial_bodies".[0m
[36m#   HINT:  Truncate table "materials" at the same time, or use TRUNCATE ... CASCADE.[0m
[36m#   /usr/local/bundle/gems/database_cleaner-active_record-2.2.0/lib/database_cleaner/active_record/truncation.rb:198:in 'DatabaseCleaner::ActiveRecord::ConnectionWrapper::PostgreSQLAdapter#truncate_tables'[0m


Finished in 0.27628 seconds (files took 30.79 seconds to load)
[31m0 examples, 0 failures, 1 error occurred outside of examples[0m

